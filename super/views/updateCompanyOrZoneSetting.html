<style>
    .widget-simple-chart {
        padding: 20px;
        border: 1px solid #e9e9e9;
        background-color: #fff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    input[type="radio"] {
        margin-right: 5px;
    }
    input[type="number"],
    input[type="text"],
    textarea {
        width: 100%;
        padding: 5px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
        box-sizing: border-box;
    }
    .company-marker {
        color: yellow;
        background-color: red;
        border-radius: 10px;
        padding: 0 3px;
        font-size: 12px;
        font-weight: bold;
    }
</style>
<div class="container-offset-lr mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-12">
            <div class="widget-simple-chart mb-5">
                <div class="border-bottom mb-3">
                    <h1><?= $pagetitle ?? 'Update Zone Customizations Settings' ?></h1>
                </div>

                <p>Note:</p>
                <ol>
                    <?php if (isset($default_company_settings)) { ?>
                    <li>Some zone settings can be set at the company level but can be overridden at the zone level. Such settings are marked with a <span class="company-marker">C</span> marker.</li>
                    <?php } ?>
                    <li>To unset a setting, set it to its default value.</li>
                </ol>

                <form id="zone-form" method="post">
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle">
                            <thead>
                                <tr>
                                    <th width="50%">Setting</th>
                                    <th width="50%">Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php
                                $lastBlockName = '';
                                $lastBlockName0 = '';
                                foreach ($zone_customizations as $key => $value) {
                                    if (!isset($default_settings[$key])) {
                                        continue;
                                    }
                                    $keys = explode('.', $key);

                                    if(count($keys) > 1){
                                        $blockName0 = $keys[0];
                                        $blockName = $keys[1];
                                    } else {
                                        continue;
                                    }

                                    if ($blockName0 !== $lastBlockName0) {
                                        if ($blockName0 == 'app') {
                                            echo '<tr class="bg-accent1"><th colspan="2"><h5>' . ucwords($blockName0) . ' Section</h5></th></tr>';
                                        } elseif ($blockName0 == 'style') {
                                            echo '<tr class="bg-accent2"><th colspan="2"><h5>' . ucwords($blockName0) . ' Section</h5> <small>Note: Some of the settings in this block are managed in zone configuration settings. Do not update them here.</small></th></tr>';
                                        } elseif ($blockName0 == 'company') {
                                            echo '<tr class="bg-accent3"><th colspan="2"><h5>' . ucwords($blockName0) . ' Section</h5></th></tr>';
                                        }
                                        $lastBlockName0 = $blockName0;
                                    }

                                    if ($blockName !== $lastBlockName) {
                                        if ($lastBlockName !== "") {
                                            echo '</td></tr>';
                                        }
                                        echo '<tr style="background-color: #efefef;"><th colspan="2"><h6>' . ucwords(str_replace(['_','-'], [' ',' '], $blockName)) . '</h6></th></tr>';
                                        $lastBlockName = $blockName;
                                    }
                                ?>
                                <tr>
                                    <td class="ps-4">
                                        <label for="<?= $key ?>">
                                            <?= $key ?>
                                            <?php if (isset($default_company_settings[$key])) { ?>
                                                <span class="company-marker">C</span>
                                            <?php } ?>
                                        </label>
                                    </td>

                                    <td>
                                        <?php if (is_bool($value) || in_array(strtolower($value), ['true', 'false'])) { ?>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="<?= $key ?>" value="true" <?= $value ? 'checked' : '' ?>>
                                                <label class="form-check-label">True <small class="text-muted"><?= $default_settings[$key] ? '[default]' : '' ?></small></label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="<?= $key ?>" value="false" <?= !$value ? 'checked' : '' ?>>
                                                <label class="form-check-label">False <small class="text-muted"><?= !$default_settings[$key] ? '[default]' : '' ?></small></label>
                                            </div>
                                        <?php } elseif (is_numeric($value)) { ?>
                                            <input type="number" name="<?= $key ?>" value="<?= $value ?>" class="form-control">
                                            <small class="text-muted"><?= htmlspecialchars($default_settings[$key]) ?></small>
                                        <?php } else { ?>
                                            <?php if (strlen($default_settings[$key]) < 32) { ?>
                                                <input type="text" name="<?= $key ?>" value="<?= htmlspecialchars($value) ?>" class="form-control">
                                            <?php } else { ?>
                                                <textarea rows="2" name="<?= $key ?>" class="form-control"><?= htmlspecialchars($value) ?></textarea>
                                            <?php } ?>
                                            <small class="text-muted"><?= htmlspecialchars($default_settings[$key]) ?></small>
                                        <?php } ?>
                                    </td>
                                </tr>
                                <?php } ?>
                            </tbody>
                        </table>
                    </div>

                    <div class="text-center mt-4">
                        <button type="submit" name="submit" class="btn save-button btn-primary">Save Changes</button>
                    </div>
                </form>
                <!-- EXISTING COMPANY JSON WAS HERE   -->
            </div>
        </div>
    </div>
</div>
<script>
    function prepareKeysBeforeSubmit() {
        const inputFields = document.querySelectorAll('input[type="radio"], input[type="number"], input[type="text"], textarea');
        inputFields.forEach(input => {
            input.name = input.name.replace(/\./g, '%DOT%');
        });
    }
    // Attached event listener to the form's submit event
    document.getElementById('zone-form').addEventListener('submit', prepareKeysBeforeSubmit);
</script>
<script>
    $("#sidebar-wrapper ul li:nth-child(5)").addClass("myactive");
</script>