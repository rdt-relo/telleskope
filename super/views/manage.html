<div class="container-offset-lr mt-5"> 
	<div class="row">              
		<div class="col-12">
			<div class="card mt-2 p-4">
				<div class="row">
					<div class="col-12 col-sm-6">
						<h1>Manage Company:</h1>
					</div>
					<?php if ($_SESSION['manage_super']) { ?>
						<div class="col-12 col-sm-6 text-end">
							<a class="btn btn-outline-primary mb-3" href="company">+ New Company</a>
						</div>
						<div class="clearfix"></div>
					<?php } ?>
					<?php if (isset($_GET['msg'])){
						if (base64_decode($_GET['msg'])==8){?>
							<div id="hidemesage" class="col-12">
								<div class="alert alert-dismissible alert-danger">
									<button type="button" class="btn-close" data-bs-dismiss="alert">&times;</button>
									<?php echo "<font color='ff0000'>".getmsg(base64_decode($_GET['msg']))."</font>"; ?>
								</div>
							</div>
					<?php } else { ?>
							<div id="hidemesage" class="col-12">	
								<div class="alert alert-dismissible alert-info">
									<button type="button" class="btn-close" data-bs-dismiss="alert">&times;</button>
									<?php echo getmsg(base64_decode($_GET['msg']));?>
								</div>
							</div>
					<?php } } else { 
						if (isset($message)){ ?>
							<div id="hidemesage" class="col-12">	
								<div class="alert alert-dismissible alert-info">
									<button type="button" class="btn-close" data-bs-dismiss="alert">&times;</button>
									<?php echo $message;?>
								</div>
							</div>
					<?php } } ?>
					
					<?php if( isset($_SESSION['updated']) && (time()- $_SESSION['updated']) < 5){ ?>
						<div id="hidemesage" class="alert alert-info alert-dismissable">
							<a href="#" class="btn-close" data-bs-dismiss="alert" aria-label="close">x</a>
							<?= UPDATED; ?>
						</div>
					<?php } elseif(isset($_SESSION['added']) && (time()- $_SESSION['added']) < 5) { ?>
						<div id="hidemesage" class="alert alert-info alert-dismissable">
							<a href="#" class="btn-close" data-bs-dismiss="alert" aria-label="close">x</a>
							<?= ADDED; ?>
						</div>
					<?php } ?>

					<div class="clearfix"></div>
					<div class="table-responsive">
						<table class="table table-bordered table-hover">
							<thead>
								<tr>
									<th width="10%">S No.</th>
									<th width="30%">Company Name</th>
									<th width="25%">Service Mode</th>
									<th width="22%">Action</th>
								</tr>
							</thead>
							<tbody>
								<?php if(count($rows)>0){
									for($i=0;$i<count($rows);$i++){ ?>
										<tr>
											<td><?php echo $i+1; ?></td>
											<td><?php echo $rows[$i]['companyname']; ?></td>
											<td>
												<select name="in_maintenance" onchange="changeCompanyServiceMode('<?= base64_encode($rows[$i]['companyid'])?>',this.value)" class="form-select" style="font-size: small;">
													<option value="<?= base64_encode(0); ?>" <?= $rows[$i]['in_maintenance'] == 0 ? 'selected' : ''; ?>>Production Mode</option>
													<option value="<?= base64_encode(1); ?>" <?= $rows[$i]['in_maintenance'] == 1 ? 'selected' : ''; ?>>Maintenance Mode 1</option>
													<option value="<?= base64_encode(2); ?>" <?= $rows[$i]['in_maintenance'] == 2 ? 'selected' : ''; ?>>Maintenance Mode 2</option>
												</select>
											</td>
											<td>
												<?php if ($rows[$i]['status']==1){ ?>
													<a class="btn btn-primary btn-sm" href='managecompany?cid=<?php echo base64_encode($rows[$i]['companyid']); ?>'>Manage</a>&nbsp;&nbsp;
												<?php } else { ?>
													<a class="btn btn-warning btn-sm confirm" href='approve?cid=<?php echo base64_encode($rows[$i]['companyid'])."&page=".$page; ?>' title="<b>Are you sure to approve Company!</b>">Approve</a>&nbsp;&nbsp;
												<?php } ?>
												<a class="btn btn-primary btn-sm" href='company?cid=<?php echo base64_encode($rows[$i]['companyid'])."&page=".$page; ?>'>Edit</a>&nbsp;&nbsp;

												<?php if($rows[$i]['isactive']==1){ ?>
													<a class="btn btn-warning btn-sm confirm" href='action.php?block=<?php echo base64_encode($rows[$i]['companyid']); ?>&page=<?php echo $page; ?>' title="<b>Are you sure to Block Company!</b>">Block</a>
												<?php } else { ?>
													<a class="btn btn-primary btn-sm confirm" href='action.php?unblock=<?php echo base64_encode($rows[$i]['companyid']); ?>&page=<?php echo $page; ?>' title="<b>Are you sure to Unblock Company!</b>">Unblock</a>
												<?php } ?>

												<?php if ($rows[$i]['isactive']==2 && Auth::HasPermission(Permission::DeleteCompany) && Auth::CanManageCompany($rows[$i]['companyid'])) { ?>
													&nbsp;
													<button type="button" class="btn btn-danger btn-sm confirm" onclick="deleteCompany('<?= base64_encode($rows[$i]['companyid']) ?>')" title="<b>Are you sure to Delete Company!</b>">Delete</button>
												<?php } ?>
											</td>
										</tr>
								<?php	} ?>
								<?php }?>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	function changeCompanyServiceMode(c,m){
		Swal.fire({
			icon:'warning',
			title: 'Are you sure to do this action?',
			showCancelButton: true,
			confirmButtonText: `Yes`,
		}).then((result) => {
			if (result.value) {
				$.ajax({
					url: 'action.php?changeCompanyServiceMode=true',
					type: 'POST',
					data: {companyid:c,mode:m},
					success: function(data) {
						if (data == 1){
							swal.fire({title: 'Success!',text:'Updated successfully'});
						} else if (data == 2){
							swal.fire({title: 'Error!',text:'Internal server error!. Please try after some time.'});
						} else {
							swal.fire({title: 'Error!',text:'Bad request.'});
						}
					},
					error: function ( data )
					{                  
						swal.fire({title: 'Error!',text:'Internal server error!. Please try after some time.'});
					}
				});
			} 
		})
	}

	jQuery("#menu-toggle").click(function(e) {
		e.preventDefault();
		jQuery("#wrapper").toggleClass("toggled");
	});
	
	$("#sidebar-wrapper ul li:nth-child(2)").addClass("myactive");
</script>

