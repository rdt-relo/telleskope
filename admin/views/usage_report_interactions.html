<style>
	.fa-ellipsis-v:after {
		display: none;
	}
</style>
<?php
const chart_bgcolor_1 = '#ffadadff';
const chart_bgcolor_2 = '#ffd6a5ff';
const chart_bgcolor_3 = '#caffbfff';
const chart_bgcolor_4 = '#9bf6ffff';
const chart_bgcolor_5 = '#a0c4ffff';
const chart_bgcolor_6 = '#bdb2ffff';
const chart_bgcolor_7 = '#ffc6ffff';
const chart_bgcolor_8 = '#fdffb6ff';
?>
<div tabindex="-1" id="theGraphModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-xl">  
        <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title text-center" id="rsvp_report_title"><?= gettext("Quick View Report");?>&nbsp;<i class="fa fa-info-circle info-black" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="<?= gettext('All the numbers below are in real time, and any real time changes will take place immediately in this report.'); ?>"></i></h4>
                    <button type="button" aria-label="close" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
    <div class="row">
       <div class="col-md-12">
          <div class="widget-simple-chart card-box">
             <div class="col-md-12">
                <h6><?= $pagetitle; ?></h6>
             </div>
             <div class="col-md-12" style="border-bottom:1px solid #6b6b6b33; margin-bottom:10px; margin-top:10px;"></div>
             <div class="clearfix"></div>

             <div>
                <div class="tab-content">
                   <div class="row">
                    <div class="col-md-12">
                        <div class="widget-simple-chart card-box-one fixhight"
                           style="margin-top: 11px;">
                           <div class="dropdown pull-right">
                                <i tabindex="0" class="dropdown-toggle fa fa-ellipsis-v fa-lg mr-2" aria-label="dropdown button" data-toggle="dropdown"></i>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li><a id="loginEmailRSVPsInteractions" href="javascript:void(0)" >Export to CSV</a></li>
                                </ul>
                            </div>
                           <canvas id="cartjs7" style="min-width: 193px; height: 413px; margin: 0 auto"></canvas>
                           <script>
                                var labels = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                                var datasets = [];
                                var loginData = [];


                            <?php for($i = 1;$i < 13;$i++) { ?>
                                loginData.push(<?= Arr::SearchColumnReturnColumnVal($rows, $i, 'month', 'login') ?: 0; ?>);
                            <?php } ?>
                                datasets.push({label: "Login",backgroundColor:'<?=chart_bgcolor_1?>',data:loginData});
                                var stackedBarChartData = {
                                    labels: labels,
                                    datasets: datasets
                                };
                              
                                var configBarChart =     {
                                    type: 'bar',
                                    data: stackedBarChartData,
                                    options: {
                                        title: {
                                                display: true,
                                                position: 'top',
                                                text: ['Login Interactions ', 'As of <?= $monthName . " " . ltrim(sufixNumber($day), '0') . " " . $year; ?>'],
                                            },
                                        barValueSpacing: 20,
                                        legend: {
                                            display: true,
                                            position: 'bottom',
                                        },
                                        scales: {
                                            yAxes: [{
                                                ticks: {
                                                    min: 0,
                                                    userCallback: function(label, index, labels) {
                                                        if (Math.floor(label) === label) {
                                                            return label;
                                                        }

                                                    },
                                                }
                                            }]
                                        }
                                    }
                                }
                                var ctxBarChart = document.getElementById("cartjs7").getContext("2d");
                                new Chart(ctxBarChart, configBarChart);

                                // EXPORT TO CSV
                                var dataLevel = JSON.parse(JSON.stringify(labels));
                                var loginDataSet = JSON.parse(JSON.stringify(loginData));
                                
                                $('#loginEmailRSVPsInteractions').on( "click", function() {
                                    var finalData = [];
                                    dataLevel.unshift('<?= $year."-".$month."-".$day; ?>')
                                    loginDataSet.unshift('Login');
                                    finalData[0] = convertArraytoObject(loginDataSet);
                                    exportCSVFile(dataLevel,finalData,'Login Interactions');
                                });
                              
                           </script>
                        </div>
                     </div>
                   </div>
                </div>
             </div>
          </div>
       </div>
    </div>
 </div>
</div>
</div>
</div>
</div>
<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    });

    $('.dropdown-toggle').keypress(function(e) {
      if (e.keyCode == 13) {
        $(this).click();
      }
    });
    
    $('#theGraphModal').on('shown.bs.modal', function () {     					 
		$('.close').focus();
	})
    retainFocus('#theGraphModal');
</script>
 </body>
 </html>