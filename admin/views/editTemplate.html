<!-- revolvapp css -->
<link rel="stylesheet" href="../vendor/js/revolvapp-2-3-10/css/revolvapp.min.css" />
<link rel="stylesheet" href="../vendor/js/revolvapp-2-3-10/plugins/variable/variable.min.css" />
<style>
    .create_template {
        background-color: #337ab7;
        color: #fff;
        margin-top: 15px;
    }
    .cancel_template{
        background-color:#80808047;
        color: #000;
        margin-top: 15px;
    }
</style>
<div class="container col-md-offset-2 margin-top">
    <div class="row">              
        <div class="col-md-12"> 
            <div class="widget-simple-chart card-box">
				<div class="col-md-12" style="border-bottom:1px solid  #e9e9e9; 	margin-bottom:20px">
					<h6>Update Template</h6>
				</div>
                <div class="col-md-12" >
                    <form class="form-horizontal" id="email_template_form" method="post">
                        <input type="hidden" name="csrf_token" value="<?=Session::GetInstance()->csrf;?>">
                        <input type="hidden" name="templateid" value="<?= $_COMPANY->encodeId($id); ?>">
                        <div class="form-group">
                            <label class=" control-lable col-md-2" >Template Name<span style="color:red;">*</span></label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="templatename" name="templatename"  value="<?= htmlspecialchars($data['templatename']); ?>" placeholder="Enter Template name here" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="templatetype" class="col-md-2 control-lable" >Template Type<span style="color:red;">*</span></label>
                            <div class="col-md-10">
                                <select type="text" class="form-control" id="templatetype" name="templatetype" >
                                    <option value="newsletter" <?= $data['templatetype']==1 ? 'selected' : 'disabled'; ?> >Newsletter</option>
                                    <option value="communications" <?= $data['templatetype']==4 ? 'selected' : 'disabled'; ?> >Communications</option>
                                    <option value="comm_anniversary_email" <?= $data['templatetype']==5 ? 'selected' : 'disabled'; ?> >Communications - Others</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group"> 
                            <label class="col-md-2 control-lable" >Create Template</label>
                            <div class="col-md-10">                         
                                <div id="email_template"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn create_template " type="button" onclick="getHtml();">Save Draft Template</button>
                            &emsp;
                            <a class="btn cancel_template" href="manage_templates">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- revolvapp js -->
<script src="../vendor/js/revolvapp-2-3-10/revolvapp-tele-2023-11-15.min.js"></script>
<script src="../vendor/js/revolvapp-2-3-10/plugins/variable/variable.min.js"></script>
<script src="../vendor/js/revolvapp-2-3-10/plugins/reorder/reorder.min.js"></script>
<script defer src="../vendor/js/revolvapp_config/revolvapp_config.js"></script>

<!-- call -->
<script>
    let app =  Revolvapp('#email_template', {
        source: true,
        plugins: ['variable', 'reorder'],
        variable: {
            items: ['COMPANY_NAME','GROUP_NAME', 'CHAPTER_NAME', 'COMPANY_URL', 'GROUP_URL', 'PUBLISH_DATE_TIME']
        }, 
        editor: {
            path: '../vendor/js/revolvapp-2-3-10/',
            maxHeight: '8000px'
        },
        toolbar: {
            sticky: true,
            stickyTopOffset: 75
        },
        image: {
            upload: "ajax.php?uploadEmailTemplateMedia=1"
        },
        
    });

    app.editor.setTemplate('<?=  $emplate; ?>');      
   
    function getHtml(e) {
        var templatename = $('#templatename').val().trim();
        var templatetype = $('#templatetype').val(); 
        if(templatename == ''){
            swal.fire({title: 'Alert!',text:'Please enter newsletter name.'});
            e.preventDefault();
        }else if (templatetype == ''){
            swal.fire({title: 'Alert!',text:'Please select a template.'});
            e.preventDefault();
        } else {
            var app = Revolvapp('#email_template');
            let source = app.editor.getTemplate().replace(/(\r\n|\n|\r)/gm,"");
            var formData = $('form#email_template_form').serialize()+'&template='+encodeURIComponent(source);
            $.ajax({
                url: 'ajax.php?addUpdateTemplate=true',
                type: 'POST',
                data: formData,
                success: function(data) {
                    swal.fire({title: 'Success!',text:'Template Updated  successfully.'})
                    .then(() => {
                        window.location.href = "manage_templates";
                    });
                },
                error: function ( data )
                {                  
                    swal.fire({title: 'Error!',text:'There has been an internal server error. Please wait and try again later.'});
                }
            });
        }
    }

</script>