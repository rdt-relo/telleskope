<?php include __DIR__.'/header.html'; ?>

<div class="container">
    <div id="user-action-box" class="card card-container wow zoomIn animated">
        <div class="head-logo">
            <img src="<?=$logo?>" height="50px"/>
            <div class="title">Create Your Account</div>

        </div>

        <div id="hidemesage" class="alert alert-danger" style="display: none;">
            <p id="message"></p>
        </div>

        <form id='verification'>
            <div class="form-group">
                <input type="email" class="form-control" name="email" id="email" value="" placeholder="Enter your email address"
                       required>
            </div>
            <div class="grecaptcha-label">
                This site is protected by reCAPTCHA and the Google
                <a href="https://policies.google.com/privacy">Privacy Policy</a> and
                <a href="https://policies.google.com/terms">Terms of Service</a> apply.
            </div>
            <div class="form-group">
                <button type="submit" id="validateButton" data-sitekey="<?=RECAPTCHA_SITE_KEY?>" data-callback='validateEmail' class="btn btn-primary btn-block center-block g-recaptcha">Submit</button>
            </div>
        </form>
        <div class="form-group">
            <div class="row no-gutters user-action-box-bottom-group">
                I already have an account,<a href="login?continue=1">&nbsp;Sign In</a>
            </div>
        </div>
        <div class="text-center grecaptcha-label mb-0">Confidential â€“ For Internal Use Only</div>
        <div id="footer-logo"></div>
    </div>
</div>

<script>
    function validateEmail(){
        var formdata = $('#verification')[0];
        var finaldata  = new FormData(formdata);
        $.ajax({
            url: 'ajax_user.php?domainverification=1',
            type: 'POST',
            data: finaldata,
            processData: false,
            contentType: false,
            success : function(data) {
                if (data == 1) {
                    window.location.replace("signup");
                } else if (data == 3) {
                    Swal.fire({
                        icon : 'error',
                        title: 'Error',
                        html: 'You are already registered. Please login into your account',
                        showConfirmButton: true,
                        confirmButtonText: 'Sign In Page'
                    }).then(function(result) {
                        window.location.href = "login?continue=1";
                    });
                } else if (data == 4) {
                    Swal.fire({
                        icon : 'error',
                        title: 'Error',
                        html: 'You are already registered. Please check your mailbox for confirmation code we sent you.',
                        showConfirmButton: true,
                        confirmButtonText: 'Confirm Code'
                    }).then(function (result) {
                        window.location.href = "confirmation";
                    });
                } else if (data == 2 || data == 5) {
                    grecaptcha.reset();
                    $("#hidemesage").show();
                    $("#message").html("Please use your company email to register");
                } else if (data == 100) {
                    grecaptcha.reset();
                    $("#hidemesage").show();
                    $("#message").html("Invalid Captcha, try again.");
                } else {
                    grecaptcha.reset();
                    $("#hidemesage").show();
                    $("#message").html("Invalid email address");
                }
            }
        });
    };
</script>

</body>
</html>